#!/usr/bin/env python

import argparse
import json
import os
import webbrowser


parser = argparse.ArgumentParser(description="open a QuantConnect notebook")
parser.add_argument("path", help="path of the notebook to open")

args = parser.parse_args()

path = args.path
if not path.endswith(".ipynb"):
    path = os.path.join(path, "research.ipynb")

project_dir = os.path.dirname(path)
file_name = os.path.basename(path)

with open("quantconnect-cli.json") as file:
    project_index = json.loads(file.read())["projectIndex"]

if project_dir not in project_index:
    print(f"'{path}' does not exist in the project index")
    exit(1)

project_id = project_index[project_dir]

webbrowser.open(f"https://www.quantconnect.com/terminal/notebook/{project_id}?file={file_name}")
